<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Data Ingestion - iris</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../quickstart.html"><strong aria-hidden="true">2.</strong> Quickstart</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../quickstart/tech_overview.html"><strong aria-hidden="true">2.1.</strong> Technical Overview</a></li><li class="chapter-item expanded "><a href="../quickstart/quick_setup.html"><strong aria-hidden="true">2.2.</strong> Quick setup guide</a></li><li class="chapter-item expanded "><a href="../quickstart/iris_overview.html"><strong aria-hidden="true">2.3.</strong> Iris Overview</a></li><li class="chapter-item expanded "><a href="../quickstart/data_ingestion.html" class="active"><strong aria-hidden="true">2.4.</strong> Data Ingestion</a></li><li class="chapter-item expanded "><a href="../quickstart/data_ejection.html"><strong aria-hidden="true">2.5.</strong> Data Ejection</a></li></ol></li><li class="chapter-item expanded "><a href="../developers.html"><strong aria-hidden="true">3.</strong> Developers</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../developers/development_guide.html"><strong aria-hidden="true">3.1.</strong> Full Node Setup Guide</a></li><li class="chapter-item expanded "><a href="../developers/nodes/ec2_setup.html"><strong aria-hidden="true">3.2.</strong> Configure a Hosted Node</a></li><li class="chapter-item expanded "><a href="../developers/contracts.html"><strong aria-hidden="true">3.3.</strong> Contracts</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../developers/contracts/contracts_chain_extension.html"><strong aria-hidden="true">3.3.1.</strong> Chain Extension</a></li><li class="chapter-item expanded "><a href="../developers/contracts/composable_access_rules.html"><strong aria-hidden="true">3.3.2.</strong> Composable Access Rule and Rule Executor</a></li><li class="chapter-item expanded "><a href="../developers/contracts/contracts_asset_exchange.html"><strong aria-hidden="true">3.3.3.</strong> Iris Asset Exchange</a></li></ol></li><li class="chapter-item expanded "><a href="../ui.html"><strong aria-hidden="true">3.4.</strong> Iris.js SDK</a></li></ol></li><li class="chapter-item expanded "><a href="../reference.html"><strong aria-hidden="true">4.</strong> Reference</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reference/pallets.html"><strong aria-hidden="true">4.1.</strong> Pallets</a></li></ol></li><li class="chapter-item expanded "><a href="../glossary.html"><strong aria-hidden="true">5.</strong> Glossary</a></li><li class="chapter-item expanded "><a href="../contact.html"><strong aria-hidden="true">6.</strong> Contact</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">iris</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="data-ingestion"><a class="header" href="#data-ingestion">Data Ingestion</a></h1>
<p>This is a quick overview of how you can ingest data into the Iris network from a user interface and to create an owned data asset class. We won't go into details on specifics of the blockchain implementation or analyze runtime storage in this overview; if you're interested in a deeper look into the specifics take a look <a href="../developers/data_assets.html">here</a>. Examples are provided on how to use the polkadotjs SDK to interact with Iris.</p>
<p><em>Note:</em> In the current version of Iris, only validator nodes are able to ingest data into the network.</p>
<h2 id="data-ingestion-workflow"><a class="header" href="#data-ingestion-workflow">Data ingestion workflow</a></h2>
<p>Data ingestion in Iris works through a multi-phase process. First, the data needs to be encrypted through the <code>iris_encrypt</code> RPC endpoint, which results in some encryption artifacts being encoded onchain while the caller is responsible for adding the generated ciphertext to IPFS and making their IPFS node discoverable by the iris gateway node IPFS network. Once added to IPFS, the data owner then invokes an extrinsic to 'complete' the ingestion of their data. Essentially, this sends a request to a gateway node to verify the data is properly encrypted, artifacts exists, the data is owned by the caller, and finally creates an data asset class on behalf of the caller, and we are done. </p>
<h3 id="step-0-setup"><a class="header" href="#step-0-setup">Step 0: Setup</a></h3>
<p>Run an IPFS node and an Iris node. Either build your own network or connect to the testnet (as per the <a href="./quick_setup.html">quick setup guide</a>). The only stipulation is that the network must have at least one proxy node and one gateway node availiable. Ensure that your IPFS node is properly configured as per the instructions <a href="../developers/development_guide.html#ipfs-installation-and-configuration">here</a>.</p>
<h3 id="step-1-encryption"><a class="header" href="#step-1-encryption">Step 1: Encryption</a></h3>
<p>In this first phase, we encrypt some plaintext using the <code>iris_encrypt</code> RPC endpoint exposed by each Iris node. The endpoint uses the umbral_pre TPRE library to generate new keys and encrypt your data. Subsequently, it sends an unsigned tx to include the generated 'capsule' and public key on-chain (see <a href="TODO">iris protocol</a> for more details). To allow a valid address to be authenticated and used for signing, the endpoint requires the caller to pass their account id along with a signature and signed message, which is used to recover the caller's account.</p>
<p><strong>To choose a proxy node</strong> query the x25519_public_keys runtime storage map in the 'Authorities' pallet and choose any validator with a key.</p>
<p>Messages can be signed with the polkadotJS library:</p>
<pre><code class="language-javascript">import { stringToU8a, u8aToHex } from '@polkadot/util';
// connect to node, create keyring and get 'account'
let message = 'random message';
let signature = account.sign(stringToU8a(message));
// convert the signature to hex before calling extrinsic
let sig_as_hex = u8aToHex(signature);
</code></pre>
<p>You can then call the iris_encrypt RPC with</p>
<pre><code class="language-javascript"> await api.rpc.iris.encrypt(plaintext, signature, signer, message, proxy)
        .then(res =&gt; success_callback(res))
        .catch(err =&gt; error_callback(err));
</code></pre>
<p>For an example, see how we handle uploads in the <a href="TODO">iris-ui</a></p>
<h3 id="step-2-add-ciphertext-to-ipfs"><a class="header" href="#step-2-add-ciphertext-to-ipfs">Step 2: Add ciphertext to IPFS</a></h3>
<p>First, ensure that your IPFS node is properly configured by attempting to find a peer who is mapped to a known validator (using <code>ipfs dht findpeer &lt;peerID&gt;</code>). This data is available in the 'SubstrateIpfsBridge' runtime storage map in the IPFS pallet.</p>
<p>Once the rpc call returns the generated ciphertext, the caller is responsible for choosing a gateway node and adding the ciphertext to an IFPS node that is reachable by the selected gateway. This would be handled within the <code>success_callback</code> that's called in the <code>then</code> block above by calling <code>ipfs add /path/to/ciphertext</code>. Once the data is in IPFS and the transaction submitted by the RPC call is encoded onchain, you can proceed to the next step.</p>
<h3 id="step-2-specify-gateway-node-and-complete-request"><a class="header" href="#step-2-specify-gateway-node-and-complete-request">Step 2: Specify gateway node and complete request</a></h3>
<p>Here we make a request to a gateway node to verify and ingest our data and to create a data asset class.
To do so, select a gateway node and call the <code>create_request</code> extrinsic exposed by the DataAssets FRAME pallet. This is the fist paid transaction for the caller, where they must pay the transaction fees as well as supply reserve currency to the requested gateway as incentive to process the transaction. Furturistically, we intent to add functionality to increase the priority of requests and to kill requests entirely. </p>
<p>Using the polkadotjs SDK, this can be called as:</p>
<pre><code class="language-javascript">await api.tx.dataAssets.createRequest(gatewayAddress, gatewayReserveAmount, cid, multiaddress, existentialDeposit)
    .signAndSend(account, result =&gt; {
        if (result.status.isInBlock) {
            isInBlockCallback(result);
        } else if (result.status.isFinalize) {
            isFinalizedCallback(result);
        }
    });
</code></pre>
<h3 id="step-3-done"><a class="header" href="#step-3-done">Step 3: Done!</a></h3>
<p>If the gateway is able to successfully verify and ingest your data, then it will create a new data asset class on your behalf. See <a href="../developers/nodes/gateway_node.html#asset_id_generation">here</a> for details on how asset ids are generated. </p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../quickstart/iris_overview.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../quickstart/data_ejection.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../quickstart/iris_overview.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../quickstart/data_ejection.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
