<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Iris-Session - iris</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../quickstart.html"><strong aria-hidden="true">2.</strong> Quickstart</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../quickstart/tech_overview.html"><strong aria-hidden="true">2.1.</strong> Technical Overview</a></li><li class="chapter-item expanded "><a href="../quickstart/development_status.html"><strong aria-hidden="true">2.2.</strong> Development Status</a></li><li class="chapter-item expanded "><a href="../quickstart/getting_started.html"><strong aria-hidden="true">2.3.</strong> Getting Started</a></li><li class="chapter-item expanded "><a href="../quickstart/data_spaces.html"><strong aria-hidden="true">2.4.</strong> Data Spaces</a></li><li class="chapter-item expanded "><a href="../quickstart/data_assets.html"><strong aria-hidden="true">2.5.</strong> Adding and Retrieving Data</a></li><li class="chapter-item expanded "><a href="../quickstart/storage.html"><strong aria-hidden="true">2.6.</strong> Storage System</a></li><li class="chapter-item expanded "><a href="../quickstart/proxy.html"><strong aria-hidden="true">2.7.</strong> Proxy Nodes</a></li><li class="chapter-item expanded "><a href="../quickstart/governance_moderation.html"><strong aria-hidden="true">2.8.</strong> Governance and Moderation</a></li></ol></li><li class="chapter-item expanded "><a href="../developers.html"><strong aria-hidden="true">3.</strong> Developers</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../pallets.html"><strong aria-hidden="true">3.1.</strong> Pallets</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../pallets/pallets_iris_assets.html"><strong aria-hidden="true">3.1.1.</strong> Iris-Assets</a></li><li class="chapter-item expanded "><a href="../pallets/pallets_iris_session.html" class="active"><strong aria-hidden="true">3.1.2.</strong> Iris-Session</a></li><li class="chapter-item expanded "><a href="../pallets/pallets_iris_ledger.html"><strong aria-hidden="true">3.1.3.</strong> Iris-Ledger</a></li><li class="chapter-item expanded "><a href="../pallets/pallets_data_spaces.html"><strong aria-hidden="true">3.1.4.</strong> Data-Spaces</a></li></ol></li><li class="chapter-item expanded "><a href="../contracts.html"><strong aria-hidden="true">3.2.</strong> Contracts</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../contracts/contracts_chain_extension.html"><strong aria-hidden="true">3.2.1.</strong> Chain Extension</a></li><li class="chapter-item expanded "><a href="../contracts/composable_access_rules.html"><strong aria-hidden="true">3.2.2.</strong> Composable Access Rule and Rule Executor</a></li><li class="chapter-item expanded "><a href="../contracts/contracts_asset_exchange.html"><strong aria-hidden="true">3.2.3.</strong> Iris Asset Exchange</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../glossary.html"><strong aria-hidden="true">4.</strong> Glossary</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">iris</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="iris-session"><a class="header" href="#iris-session">Iris-Session</a></h1>
<p>The Iris-session pallet incorporates both IPFS and the <a href="https://github.com/paritytech/substrate/blob/master/frame/session/README.md">session module</a> to allow network validators to provide storage for some existing asset class for the duration of a session. In general, it provides the capabilities to:</p>
<ul>
<li>provide storage to the network</li>
<li>capitalize on latent storage capacity</li>
<li>eject data from the network</li>
</ul>
<h2 id="runtime-details"><a class="header" href="#runtime-details">Runtime Details</a></h2>
<h3 id="interaction-with-embedded-ipfs"><a class="header" href="#interaction-with-embedded-ipfs">Interaction with Embedded IPFS</a></h3>
<p>The iris-session pallet contains the core logic for interacting with the embedded IPFS instance. In this module we expose the capability for offchain workers to process commands added to the DataQueue. Specifically, to:</p>
<ul>
<li>read IPFS public key and muiltiaddresses</li>
<li>add data to the IPFS by processing an AddBytes command</li>
<li>fetch data from IPFS by processing a CatBytes command</li>
<li>pin data to IPFS by processing a PinBytes command</li>
</ul>
<p>When a node adds an AddBytes command to the queue (via the iris-assets pallet), any other node is capable of processing the command and injecting the data into the network.</p>
<p>When a node adds a CatBytes command to the queue, it is uniquely processed by the calling node, adding the data to offchain storage so that it can be fetched via the RPC endpoint.</p>
<p>When a node adds a PinBytes command to the queue, it is uniquely processed by the calling node. The also results in the addition of the node to the <em>Pinners</em> storage map.</p>
<h3 id="session-based-approach-to-adding-validators"><a class="header" href="#session-based-approach-to-adding-validators">Session-based approach to adding validators</a></h3>
<p>Iris is a proof of authority network. Through the usage of the session pallet, we introduce a mechanism for an existing authority to add new validators to the network. Iris uses Aura for consensus and Grandpa for block finalization and there is no alteration to the default process through which nodes are rewarded.</p>
<p>In the long term, we intend to create a new consensus, which we are calling <code>Nominated Proof of Storage Capacity</code>. Details of this to come.</p>
<h3 id="session-based-approach-to-adding-and-rewarding-storage-providers"><a class="header" href="#session-based-approach-to-adding-and-rewarding-storage-providers">Session-based approach to adding and rewarding storage providers</a></h3>
<p><em>Note</em>: We currently follow a fairly naive scheme for incentivizing validators to store content. We intend to replace the below scheme with something much more mature in the future.</p>
<p>Validator nodes are a superset of the storage provider nodes. Validators, using the iris-session pallet, can request to store some owned content added to Iris. For example, if a node has added data and created a content asset class, then a validator node can request to store the content during the subsequent session.</p>
<p>There are three phases to each session:</p>
<ol>
<li>a pre-session planning phase</li>
<li>a session start phase</li>
<li>a session end phase</li>
</ol>
<p>When we say <strong>current session</strong> we mean a session that has been <em>planned</em>, and for which the possible storage providers are locked but not yet necessarily providing active storage. An <strong>active session</strong> is a session that has been <em>started</em> and for which the nodes are active storage providers. This is elaborated below:</p>
<ol>
<li>
<p>Pre-session planning: candidate storage providers that have pinned the CID they requested to store are added to a collection of active storage providers for that asset class for that session. The current session is incremented by one.</p>
</li>
<li>
<p>Session Start: The active session is incremented by one.</p>
</li>
<li>
<p>Session End: Validiators that have been storing data but have not accumulated any reward points for some preconfigured number of sessions (MaxDeadSessions) is removed from the validator pool.</p>
</li>
</ol>
<h3 id="reward-point-calculation"><a class="header" href="#reward-point-calculation">Reward Point Calculation</a></h3>
<p>Reward points are the interim rewards that storage providers receive for processing requests in the DataQueue. DataCommands are added to the DataQueue when:</p>
<ul>
<li>a content owner has requested to add data to Iris via the <code>create</code> extrinsic</li>
<li>successfully pinning data</li>
<li>a consumer has requested to fetch bytes from ipfs through the <code>retrieve_data</code> extrinsic.</li>
</ul>
<p>When data is requested from Iris, the underlying IPFS network will fetch the bytes from one of the storage providers (though it's possible it could exist in another node since we don't have much in terms of garbage collection in rust-ipfs). Though it may be possible to determine exactly which IPFS node the data was fetched from, this is most likely computationally expensive. We track the number of times some data was successfully requested (i.e. the number of times a consumer requested to fetch the content of an asset class of which they own an asset). At the end of the session, the total sum is distributed evenly to storage providers for that asset during the session.</p>
<p>Validators are rewarded for:</p>
<ul>
<li>Processing requests to inject data into IPFS (basically <code>ipfs add [cid]</code>)
<ul>
<li>Awarded 1 RP</li>
</ul>
</li>
<li>Pinning data to their embedded IPFS node (<code>ipfs pin [cid]</code>)
<ul>
<li>Awarded 1 RP</li>
</ul>
</li>
<li>Indirectly, when another node requests data they are providing storage for
<ul>
<li>The number of unallocated tokens for the session is incremented by 1</li>
</ul>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../pallets/pallets_iris_assets.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../pallets/pallets_iris_ledger.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../pallets/pallets_iris_assets.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../pallets/pallets_iris_ledger.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
